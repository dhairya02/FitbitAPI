{% extends "base.html" %}

{% block title %}Help & Setup - Fitbit Sync{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Page Header -->
    <div class="fade-in">
        <h1 class="text-3xl font-bold text-gray-900">Help & Setup Guide</h1>
        <p class="mt-2 text-gray-600">Everything you need to get started with Fitbit data sync.</p>
    </div>

    <!-- Quick Links -->
    <div class="fade-in bg-white rounded-lg shadow-md border border-gray-200 p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Quick Navigation</h2>
        <div class="flex flex-wrap gap-3">
            <a href="#requirements" class="px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors">
                Requirements
            </a>
            <a href="#fitbit-setup" class="px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors">
                Fitbit App Setup
            </a>
            <a href="#configuration" class="px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors">
                App Configuration
            </a>
            <a href="#usage" class="px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors">
                Usage Instructions
            </a>
        </div>
    </div>

    <!-- Requirements Section -->
    <div id="requirements" class="fade-in bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
        <div class="px-6 py-5 border-b border-gray-200 bg-gray-50">
            <h2 class="text-2xl font-semibold text-gray-900">What You Need</h2>
        </div>
        <div class="px-6 py-6">
            <div class="space-y-4">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                            <span class="text-blue-600 font-semibold">1</span>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-medium text-gray-900">Fitbit Developer Account</h3>
                        <p class="mt-1 text-gray-600">A free account on the Fitbit Developer Portal to create and manage your application.</p>
                    </div>
                </div>
                
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                            <span class="text-blue-600 font-semibold">2</span>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-medium text-gray-900">Fitbit Application Credentials</h3>
                        <p class="mt-1 text-gray-600">Client ID and Client Secret from your Fitbit application.</p>
                    </div>
                </div>
                
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                            <span class="text-blue-600 font-semibold">3</span>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-medium text-gray-900">Python Environment</h3>
                        <p class="mt-1 text-gray-600">Python 3.12 with required packages installed (Flask, SQLAlchemy, fitbit, etc.)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fitbit App Setup -->
    <div id="fitbit-setup" class="fade-in bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
        <div class="px-6 py-5 border-b border-gray-200 bg-gray-50">
            <h2 class="text-2xl font-semibold text-gray-900">Setting Up Your Fitbit Application</h2>
        </div>
        <div class="px-6 py-6">
            <div class="prose max-w-none">
                <div class="space-y-6">
                    <!-- Step 1 -->
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Step 1: Access the Fitbit Developer Portal</h3>
                        <p class="text-gray-700">Go to the Fitbit Developer Portal and sign in with your Fitbit account. If you don't have an account, create one for free.</p>
                    </div>
                    
                    <!-- Step 2 -->
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Step 2: Register a New Application</h3>
                        <p class="text-gray-700 mb-2">Click on "Register a New App" and fill in the required information:</p>
                        <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                            <li><strong>Application Name:</strong> Choose any name (e.g., "My Fitbit Sync App")</li>
                            <li><strong>Description:</strong> Brief description of your app</li>
                            <li><strong>Application Website:</strong> Can be http://localhost:5000 for development</li>
                            <li><strong>Organization:</strong> Your name or organization</li>
                            <li><strong>Organization Website:</strong> Can be the same as Application Website</li>
                            <li><strong>OAuth 2.0 Application Type:</strong> Select <span class="font-semibold text-blue-600">"Personal"</span> (recommended) or "Server"</li>
                            <li><strong>Redirect URL:</strong> Enter <code class="bg-gray-100 px-2 py-1 rounded text-sm">{{ redirect_uri }}</code></li>
                        </ul>
                        <div class="mt-3 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <p class="text-sm text-yellow-800">
                                <strong>Important:</strong> For "Personal" application type, you'll have automatic access to intraday data. 
                                For "Server" applications, you need to request special permission from Fitbit for intraday access.
                            </p>
                        </div>
                    </div>
                    
                    <!-- Step 3 -->
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Step 3: Configure OAuth 2.0 Settings</h3>
                        <p class="text-gray-700 mb-2">After creating your app, configure the OAuth scopes. You'll need these scopes:</p>
                        <div class="bg-gray-50 rounded-lg p-4 mt-2">
                            <code class="text-sm text-gray-800">{{ scopes }}</code>
                        </div>
                        <p class="text-gray-600 text-sm mt-2">These scopes allow the app to read your activity, heart rate, sleep, weight, and profile data.</p>
                    </div>
                    
                    <!-- Step 4 -->
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Step 4: Save Your Credentials</h3>
                        <p class="text-gray-700 mb-2">On your app's details page, you'll find:</p>
                        <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                            <li><strong>OAuth 2.0 Client ID:</strong> Copy this value</li>
                            <li><strong>Client Secret:</strong> Copy this value (keep it secure!)</li>
                        </ul>
                        <div class="mt-3 bg-red-50 border border-red-200 rounded-lg p-4">
                            <p class="text-sm text-red-800">
                                <strong>Security Warning:</strong> Never share your Client Secret publicly or commit it to version control. 
                                Always use environment variables.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Configuration Section -->
    <div id="configuration" class="fade-in bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
        <div class="px-6 py-5 border-b border-gray-200 bg-gray-50">
            <h2 class="text-2xl font-semibold text-gray-900">Configuring This Application</h2>
        </div>
        <div class="px-6 py-6">
            <p class="text-gray-700 mb-4">Set the following environment variables before running the app:</p>
            
            <!-- Required Variables -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-3">Required Variables</h3>
                <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
                    <pre class="text-green-400 text-sm"><code>export FITBIT_CLIENT_ID="your_client_id_here"
export FITBIT_CLIENT_SECRET="your_client_secret_here"</code></pre>
                </div>
            </div>
            
            <!-- Optional Variables -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-3">Optional Variables (with defaults)</h3>
                <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
                    <pre class="text-green-400 text-sm"><code>export FITBIT_REDIRECT_URI="{{ redirect_uri }}"
export FITBIT_SCOPES="{{ scopes }}"
export FLASK_SECRET_KEY="your-random-secret-key-here"
export DATABASE_URL="sqlite:///fitbit_singleuser.db"
export FITBIT_DATA_DIR="fitbit_data"</code></pre>
                </div>
            </div>
            
            <!-- Using .env file -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-blue-900 mb-2">ðŸ’¡ Pro Tip: Use a .env file</h4>
                <p class="text-sm text-blue-800 mb-2">Create a <code class="bg-blue-100 px-1 rounded">.env</code> file in your project root:</p>
                <div class="bg-white rounded p-3 mt-2">
                    <pre class="text-xs text-gray-800"><code>FITBIT_CLIENT_ID=your_client_id_here
FITBIT_CLIENT_SECRET=your_client_secret_here
FITBIT_REDIRECT_URI={{ redirect_uri }}
FLASK_SECRET_KEY=some-long-random-string</code></pre>
                </div>
                <p class="text-sm text-blue-800 mt-2">The app will automatically load these variables using python-dotenv.</p>
            </div>
        </div>
    </div>

    <!-- Usage Instructions -->
    <div id="usage" class="fade-in bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
        <div class="px-6 py-5 border-b border-gray-200 bg-gray-50">
            <h2 class="text-2xl font-semibold text-gray-900">How to Use This App</h2>
        </div>
        <div class="px-6 py-6">
            <div class="space-y-6">
                <!-- Starting the App -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">Starting the Application</h3>
                    <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
                        <pre class="text-green-400 text-sm"><code># Activate your virtual environment
source venv/bin/activate

# Set environment variables (or use .env file)
export FITBIT_CLIENT_ID="..."
export FITBIT_CLIENT_SECRET="..."

# Run the app
python -m backend.app</code></pre>
                    </div>
                </div>
                
                <!-- Using the Dashboard -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">Using the Dashboard</h3>
                    <ol class="space-y-3">
                        <li class="flex items-start">
                            <span class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold mr-3">1</span>
                            <div>
                                <p class="text-gray-700"><strong>Connect Your Fitbit Account:</strong> Click the "Connect Fitbit" button on the dashboard. You'll be redirected to Fitbit's login page.</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold mr-3">2</span>
                            <div>
                                <p class="text-gray-700"><strong>Authorize the App:</strong> Log in to Fitbit and grant the requested permissions.</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold mr-3">3</span>
                            <div>
                                <p class="text-gray-700"><strong>Return to Dashboard:</strong> After successful authorization, you'll see "Connected" status on the dashboard.</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold mr-3">4</span>
                            <div>
                                <p class="text-gray-700"><strong>Sync Your Data:</strong> Click "Sync Data Now" to pull yesterday's activity and heart rate data.</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="flex-shrink-0 h-6 w-6 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold mr-3">5</span>
                            <div>
                                <p class="text-gray-700"><strong>Access Your Data:</strong> JSON files will be saved in <code class="bg-gray-100 px-2 py-1 rounded text-sm">fitbit_data/default/</code></p>
                            </div>
                        </li>
                    </ol>
                </div>
                
                <!-- Data Stored -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">What Data is Synced?</h3>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <ul class="space-y-2 text-gray-700">
                            <li class="flex items-start">
                                <svg class="h-5 w-5 text-green-600 mr-2 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <span><strong>Steps Summary:</strong> Daily step count for yesterday</span>
                            </li>
                            <li class="flex items-start">
                                <svg class="h-5 w-5 text-green-600 mr-2 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <span><strong>Heart Rate Intraday:</strong> 1-minute resolution heart rate data for yesterday</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Troubleshooting -->
    <div class="fade-in bg-yellow-50 border border-yellow-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">ðŸ”§ Troubleshooting</h3>
        <div class="space-y-3 text-sm text-gray-700">
            <div>
                <p class="font-semibold text-gray-900">Can't connect to Fitbit?</p>
                <p>Make sure your Redirect URI in the Fitbit app matches exactly: <code class="bg-yellow-100 px-1 rounded">{{ redirect_uri }}</code></p>
            </div>
            <div>
                <p class="font-semibold text-gray-900">Heart rate intraday fails?</p>
                <p>Ensure your Fitbit app is set to "Personal" type, or request intraday access for "Server" apps. Also verify "heartrate" is in your scopes.</p>
            </div>
            <div>
                <p class="font-semibold text-gray-900">Token expired errors?</p>
                <p>The app automatically refreshes tokens, but if issues persist, try disconnecting and reconnecting your Fitbit account.</p>
            </div>
        </div>
    </div>

    <!-- Back to Dashboard -->
    <div class="fade-in text-center">
        <a href="{{ url_for('dashboard') }}" 
           class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-colors">
            <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            Back to Dashboard
        </a>
    </div>
</div>
{% endblock %}

